import unittest
from unittest.mock import patch

from business.medical_report_analyzer import MedicalReportAnalyzer


class MedicalReportAnalyzerTest(unittest.TestCase):
    """
        Test medical report analyzer
    """

    def setUp(self):
        """
            Initialize report data for testing
        """

        self.data = '''
HOSPITAL DE EJEMPLO
Dirección: Calle Inventada nº84 11111 Madrid (España)
Teléfono: 0123456789
                                  INFORME DE URGENCIAS
Paciente: 836195          Episodio: 125672        Fecha de documento: 24/11/2020    Área: Urgencias          Servicio: Traumatología Facultativo/a: Dr. Tal Tal
Nombre del paciente: Tal tal tal      Fecha de nacimiento: 05/04/1982    Sexo: Hombre           Dirección: Calle Inventada nº2 33333 Madrid (España)
Motivo de consulta: Tal motivo        Fecha de consulta: 23/11/2020
Anamnesis:
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
TEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRETEXTOLIBRE
Diagnóstico: Tal diagnóstico
Tratamiento: Tal tratamiento
        '''

    def test_ok(self):

        # Almost real test data

        manager = MedicalReportAnalyzer()
        result = manager.process(self.data)

        self.assertEqual(result['mr_number'], '836195')

    def test_no_data(self):
        
        manager = MedicalReportAnalyzer()

        with self.assertRaises(ValueError) as context:
            manager.process(None)

        self.assertTrue('No report data' in str(context.exception))


if __name__ == '__main__':
    unittest.main()
